3d2
< 
14d12
< 
25a24
> #include "logging_mosq.h"
30c29
< int log__printf(struct mosquitto *mosq, int priority, const char *fmt, ...)
---
> int log__printf(struct mosquitto *mosq, unsigned int priority, const char *fmt, ...)
32a32
> 	char *s;
40a41,45
> 		s = mosquitto__malloc(len*sizeof(char));
> 		if(!s){
> 			pthread_mutex_unlock(&mosq->log_callback_mutex);
> 			return MOSQ_ERR_NOMEM;
> 		}
43c48
< 		vsnprintf(mosq->log_string, len, fmt, va);
---
> 		vsnprintf(s, len, fmt, va);
44a50
> 		s[len-1] = '\0'; /* Ensure string is null terminated. */
46c52,54
< 		mosq->on_log(mosq, mosq->userdata, priority, mosq->log_string);
---
> 		mosq->on_log(mosq, mosq->userdata, (int)priority, s);
> 
> 		mosquitto__free(s);
51,52c59
< }
< 
---
> }
\ No newline at end of file
